<!DOCTYPE html>
<html>
  <head>
    <title>ProjectMe: <%= title %></title>
    <link href="https://fonts.googleapis.com/css?family=Lobster|Lobster+Two|Raleway|Roboto+Condensed&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto|Ubuntu&display=swap" rel="stylesheet">
    
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="icon" href="/images/logo.png">
  </head>
  <body>
    
    <header id="top-header-small">
      <h1 id="main-brand-header-small">ProjectMe &nbsp;<span id="span-in-line-small">Find your next, perfect project!</span></h1>
      <div id="login-signup-container-small">
        <%if(user){%>
          
          
          
          Welcome! <span id="user-blue"><%=user.username%></span>
          <a href="/logout"><button id="login">Log Out</button></a>
          <%}else{%>
            <a href="/auth/google"><button id="login">Log In With Google</button></a>
          
        <%}%>
        
      </div>
    </header>
    <div id="message-bar"></div>
    <nav id="nav-bar">
      <ul>
        <li><a href="/about">About</a></li>
        <li><a href="/">ProjectMe</a></li>
        <li><a href="/categories">Categories</a></li>
        <li><a href="/Posts">Posts</a></li>
        <%if(user){%>
            <li><a href="/user"><span id="blue">Profile</span></a></li>
        <%}%>
    
      </ul>
    </nav>
    <div id="centered-body-container">
      <span class="favorite-container"><h1 class="centeredh1 capitalize"><%=title%>
        <%if(user){%>
            <%if(user.favorites.includes(title)){%>
                <form action="/user/favorites/<%=title%>" method="post"><button class="favorite-button-favorited">⭐</button>
            <%}else{%>

                <form action="/user/favorites/<%=title%>" method="post"><button class="favorite-button">⭐</button>
            <%}%>
        <%}%>
        </form></h1></span>
      
      <%if(user){%>
        <section class="new-post">
          <form action="/posts" method="POST" autocomplete="off" class="post-form">
            <input type="text" name="title" placeholder="Post Title" id="post-title-input">
            <span id="user-tag">
              Posting as <span id="user-blue"><%=user.username%></span>
  
            </span>
            
            <br>
            <br>
            <select name="category" id="post-category-input" placeholder="Category">
              <option value="" disabled selected>Select Category</option>
              <option name="programming" value="programming">Programming</option>
              <option name="carpentry" value="carpentry">Carpentry</option>
              <option name="blacksmithing" value="blacksmithing">Blacksmithing</option>
              <option name="machining" value="machining">Machining</option>
              <option name="art" value="art">Art</option>
              <option name="uxdesign" value="uxdesign">UX Design</option>
              <option name="math" value="math">Math</option>
              <option name="metalworking" value="metalworking">Metalworking</option>
  
            </select>
            <textarea name="content" id="post-content-input" placeholder="......">
            </textarea>
            <button type="submit" id="post-button">Post</button>
          </form>
          </select>       
        </section>
        <%}else{%>
          
      <%}%>
        
        <%posts.forEach(post=>{%>
        <section class="post" data-id="<%=post._id%>">
          <div id="author-profile">
            <div id="author-profile-pic">
                
              <img src="<%=post.username.toObject().avatar%>" class="user-profile-pic"/>  
            </div>
            <h3>
              
              <%=post.username.toObject().username%>
              
              
            </h3>
  
                  
          </div>
          <p class="post-p">
            <%=post.content%>
          </p>
          <div class="post-content">
            <div class="post-title">
              <h2><%=post.title%></h2>
  
            </div>
            
            <div class="post-footer">
              <span class="category-tag">
                <%=post.category%>
              </span>
              <%if(user){%>
                <%if(post.username.toObject().googleId===user.googleId){%>
                  
                  <button class="comment-button" data-id="<%=post._id%>">
                    <%if(post.comments.length>1){%>
                      View <%=post.comments.length%> Comments
                    <%}else if(post.comments.length === 1){%>
                      View <%=post.comments.length%> Comment
                    <%}else{%>
                      Comment
                    <%}%>
                  
                  </button>
                
                <button class="like-button">Like</button>
                <button type="submit" class="edit-button">Edit</button>  
                <form class="delete-form"action="/posts/<%=post._id%>?_method=DELETE" method="POST">
                  <button type="submit" class="delete-button">Delete</button>          
                </form>
                <%}else{%>
                  <button class="comment-button comment-button-bottomed" data-id="<%=post._id%>">
                    <%if(post.comments.length>1){%>
                      View <%=post.comments.length%> Comments
                    <%}else if(post.comments.length === 1){%>
                      View <%=post.comments.length%> Comment
                    <%}else{%>
                      Comment
                    <%}%>
                  
                  </button>
                <button class="like-button like-button-bottomed">Like</button>
    
                <%}%>
              
            </div>
            <%}%>
          </div>
  
          
          
        </section>
          <section class="post-comment-wrapper" data-id="<%=post._id%>">
            <form action="/posts/<%=post._id%>/comments" class="comment-form" method="POST">
              <textarea name="commentContent" class="comment-content-input"></textarea>
              <button type="submit" class="comment-post-button">Post</button>
            </form>
            <hr>
            <div class="comments-wrapper">
            <%if(user){%>
            
                <%if(post.comments){%>
                  <%post.comments.forEach(comment=>{%>
                    <%if(comment.author===user.username){%>
                      <div class="comment-wrapper">
                        <h2 class="comment-author">
                          
                        </h2>
                        <p class="comment-content">
                          
                        </p>
                        <div class="edit-form-container">
  
                        </div>
                        <span class="comment-footer">
  
                          <button class="comment-edit-button" data-id="<%=comment.id%>">Edit</button>
                          <form action="/posts/<%=post.id%>/comments/<%=comment.id%>?_method=DELETE" method="POST">
                            <button class="comment-delete-button">Delete</button>
                          </form>
                        </span>
                      </div>
                      
                      <%}else{%>
                        <div class="comment-wrapper">
                          <h2 class="comment-author">
                            
                          </h2>
                          <p class="comment-content">
                            
                          </p>
                          
                        </div>
                        
                        <%}%>  
                        <%})%>
                      <%}%>
                
                
                
                           
  
              <%}%>
            </div>
        </section>
        <%})%>
  
  
    </div>
    
  </body>
</html>
